<!DOCTYPE html>
<html lang="en">
	<head>
		<meta name="description" content="HTML5: All Your Games Are Belong to Us">
		<meta name="author" content="Erik Onarheim">
		<link rel="stylesheet" type="text/css" href="css/presentation.css">
		<link rel="stylesheet" type="text/css" href="css/custom.css">

	</head>
	<!-- Notes
	How do you build games in HTML5? In this talk we will learn about the basics of game development and how to apply it in a canvas based HTML5 game. We will be building a simple game live on the screen by leveraging JavaScript and new HTML5 features. We will learn about drawing to the HTML5 canvas, handling key input, maintaining frame rate, the subtleties of performing rotations and translations, setting up audio, sprite animations, basic game physics, and multiplayer support! I will also discuss some lessons in game programming that I learned the hard way so that you don’t have to. If you are interested in web game development, come learn about everything you need to make your first game –from the basics to the advanced.


	-->

	<body class="impress-not-supported">

		<div id="impress">
			<div id="introduction" class="step slide" data-x="-1500" data-y="-1500">
			    <p><b>HTML5: All Your Games Are Belong to Us</b></p>
			    <p> Building Games in HTML5 and JavaScript
			    
			    <br/>
			    <ul>
			    	<li><img src="images/cats.png" class="right-image border" style="
	width: 600px;"></li>
			    	<li>Erik Onarheim - Software Developer</li>
			    	<li>@ErikOnarheim</li>
			    	<li>erikonarheim.com</li>
			    </ul>
				</p>
			</div>
			<div id="about" class="step slide" data-x="-1500" data-y="0">
				<p><b>About Me</b></p>
				<hr/>
				<ul>
					<li><img src="images/me.png" class="right-float border"></li>
					<li class="space10">Software Developer @ General Mills</li>
					<li class="space10">Video Game Enthusiast</li>
					<li class="space10">Excalibur js - <a href="http://www.excaliburjs.com">excaliburjs.com</a></li>
					<li class="space10">Artist</li>
					<li class="space10">Hacker</li>
				</ul>

			</div>
			<div id="building-blocks" class="step slide" data-x="-1500" data-y="1500">
				<p><b>HTML5 Games: The Building Blocks</b></p>
				
				<hr/>
				<ul style="margin-top:100px">
					<li><img src="images/buildingblocks.png" style="width:100%"></li>
				<ul>
			</div>
			<div id="canvas-overview" class="step slide" data-x="-1500" data-y="3000" >
				<p><b>Canvas</b></p>
				<hr>
				<img src="images/canvas.svg" style="width:100%">
			</div>

			<div id="canvas-visual-aid" class="step" data-x="-1500" data-y="4500">
				<img src="images/canvasresolution.png" style="width:100%">
			</div>


			<div id="code-drawing" class="step slide" data-x="0" data-y="0">
				<p><b>Code:</b> Drawing</p>
				<hr>
				<div id="drawing-editor" class="code-editor">var canvas = document.getElementById('canvas1');
var ctx = canvas.getContext('2d');

var erase = function(){
    ctx.fillStyle = 'black';
    ctx.fillRect(0,0,canvas.width, canvas.height);
};

// rectangles
ctx.fillStyle = 'white';
ctx.fillRect(50, 50, 50, 50);

// circles
erase();
ctx.fillStyle = 'red';
ctx.beginPath();
ctx.arc(50, 50, 10, 0, Math.PI*1);
ctx.closePath();
ctx.fill();

// text
erase();
ctx.fillStyle = 'white';
ctx.fillText('Hello Canvas!', 100,100);

// images
erase();
var image = new Image();
image.src = './images/me.png';
ctx.drawImage(image, 0, 0, 213, 500, 75, 0, 100, 150);

// affine transformations
erase();
ctx.save();
ctx.translate(100,100);
ctx.rotate(Math.PI/4);
ctx.scale(2, 2);
ctx.fillStyle = 'white';
ctx.fillText('Rotated Text', -50, -10);
ctx.restore();</div>
			</div>

			<div id="example-drawing" class="step slide" data-x="0" data-y="0" data-z="2000">
				<p><b>Example:</b> Drawing</p>
				<button id="btn-drawing" class="btn btn-primary">Start</button>
				<hr/>
				<canvas id="canvas1" width="480" height="320" class="border">
				</canvas>
			</div>

			

			<div id="time-based-movement" class="step slide" data-x="0" data-y="1500">
				<p><b>Code:</b> Movement</p>
				<hr>
				<div id="movement-editor" class="code-editor">if(!window.requestAnimationFrame){
    window.requestAnimationFrame = webkitRequestAnimationFrame ||
    mozRequestAnimationFrame || msRequestAnimationFrame || 
    function(callback){window.setInterval(callback, 1000/60)};
}

var canvas = document.getElementById('canvas2');
var ctx = canvas.getContext('2d');

var x = 10;
var y = 10;
var dx = 1;
var dy = 0;

var running = true;
(function mainloop(){
    if(!running) return;

    window.requestAnimationFrame(mainloop);
    
    // Update position
    x += dx;
    y += dy;
    
    dx += 1;
    dy += 0;
    
    // Clear Canvas
    ctx.fillStyle = 'black';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    // Draw shape
    ctx.fillStyle = 'red';
    ctx.fillRect(x, 10, 50, 50);
})();</div>
			</div>

			<div id="example-time-based-movement" class="step slide" data-x="0" data-y="1500" data-z="2000">
				<p><b>Example:</b> Movement</p>
				<button id="btn-time-based-movement" class="btn btn-primary">Start</button>
				<hr/>
				<canvas id="canvas2" width="480" height="320" class="border">
				</canvas>
			</div>

			<div id="time-fps" class="step slide" data-x="0" data-y="3000">
				<p><b>Timing</b></p>
				<hr>
				<img src="images/fpscalculation.svg" style="width:100%; margin-top:50px" class="border">
			</div>

			<div id="timing" class="step slide" data-x="0" data-y="4500">
				<p><b>Code:</b> Timing</p>
				<hr/>
				<div id="timing-editor" class="code-editor">var canvas = document.getElementById('canvas3');
var ctx = canvas.getContext('2d');

var clear = function(){
    ctx.fillStyle = 'black';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
};
var drawFPS = function(fps){
    ctx.fillStyle = 'red';
    ctx.fillText('FPS: ' + fps.toFixed(1), 5, 20);
};

var x = 0;
var y = 40;
var dx = 3;
var dy = 0;

var update = function(delta){
    var seconds = delta/1000;
    x += dx*seconds;
    y += dy*seconds;    
};

var draw = function(){
    clear();
    ctx.fillStyle = 'blue';
    ctx.fillRect(x, y, 30, 30);
};

var lastTime =  Date.now();
var interval = setInterval(function(){
	// Get the time to calculate time-elapsed
	var now = Date.now();
	var elapsed = Math.floor(now - lastTime);
    update(elapsed);
    draw();
    drawFPS(1/(elapsed/1000));

	lastTime = now;
}, 16);	</div>
			</div>

			<div id="example-timing" class="step slide" data-x="0" data-y="4500" data-z="2000">
				<p><b>Example:</b> Timing</p>
				<button id="btn-timing" class="btn btn-primary">Start</button>
				<hr>
				<canvas id="canvas3" width="480" height="320" class="border">
				</canvas>
			</div>

			<div id="code-gameloop" class="step slide" data-x="0" data-y="6000">
				<p><b>Code:</b> Game Loop</p>
				<hr>
				<div id="gameloop-editor" class="code-editor">var Game = function(){
	var me = this;
	me.update = function(delta){
		// update state of the game
		// including players, npcs, scenery, animations, etc.
	};

	me.draw = function(delta){
		// draw the game
	};

	me.start = function(){
		// todo: implement gameloop
		var lastTime =  Date.now();
		setInterval(function(){
			// Get the time to calculate time-elapsed
			var now = Date.now();

			var elapsed = Math.floor(now - lastTime);

			me.update(elapsed); 
			me.draw(elapsed);

			lastTime = now;
		}, 30);	
	};

	return me;
};

var game = new Game();
game.start();</div>
			</div>
			<div id="collision-detection1" class="step slide" data-x="0" data-y="7500">
				<p><b>Collision Detection</b></p>
				<hr>
				<ul>
					<li class="space10"><b>Bounding Areas</b> - Circles, Rectangles</li>
					<li class="space10"><b>Ray Casting</b> - Linear Algebra</li>
					<li class="space10"><b>Spatial Partitioning*</b></li>
					<li class="space10"><b>Separating Axis Theorem*</b><li>
				</ul>
			</div>

			<div id="collision-detection-circles" class="step slide" data-x="1500" data-y="6000">
				<p><b>Collision Detection:</b> Circles</p>
				<hr>
				<img src="images/circlecollision.svg" style="height:90%;width:100%">
			</div>
			<div id="collision-detection-rectangles" class="step slide" data-x="3000" data-y="6000">
				<p><b>Collision Detection:</b> Rectangles</p>
				<hr>
				<img src="images/rectanglecollision.svg" style="height:90%; width:100%">
				<!-- collides(A,B){
			   ARight = A.x + A.w
			   BRight = B.x + B.w
			   ABottom = A.y + A.h
			   BBottom = B.y + B.h
			   return ARight > B.x &&
              A.x < BRight &&
              ABottom < B.y &&
              A.y > BBottom} -->
			</div>

			<div id="collision-detection-spatial-partitioning-strict" class="step slide" data-x="4500" data-y="6000">
				<p><b>Collision Detection:</b> Spatial Partitioning</p>
				<hr>
				<img src="images/spatialpartitioning.svg" style="padding-top:50px;width:100%">
			</div>

			<div id="handling-key-events" class="step slide">
				<p><b>Handling Key Events</b></p>
				<hr>
				<ul>
					<li>Recommend</li>
				</ul>

			</div>
			<div id="code-handling-key-events-vector" class="step slide">
				<p><b>Handling Key Events:</b> Key Vector</p>
				<div id="keycode-vector-editor" class="code-editor">var keys = [];
window.addEventListener('keydown', function(e){
	if(keys.indexOf(e.keyCode) === -1){
		keys.push(e.keyCode);
	}
});
window.addEventListener('keyup', function(e){
	var index;
	if((index = keys.indexOf(e.keyCode)) > 0){
		keys.splice(index,1);
	}
});</div>
			</div>
			<div id="code-handling-key-events-konami" class="step slide">
				<p><b>Key Combinations:</b> Konami Code</p>
				<hr>
				<div id="keycode-konami-editor" class="code-editor">(function(){
	var game = new Snake();
	var keys = [];
	var konami = "38,38,40,40,37,39,37,39,66,65";
	window.addEventListener('keydown', function(e) {
        keys.push(e.keyCode);
        if(keys.toString().indexOf(konami) >= 0 ){
            keys.length = 0;
            game.start();
        }
	});
})();

// Courtesy Paul Irish 
// http://www.paulirish.com/2009/cornify-easter-egg-with-jquery/</div>
			</div>


		</div>

		<script type="text/javascript" src="lib/jquery-2.0.3.min.js"></script>
		<script type="text/javascript" src="lib/impress.js"></script>
		<script type="text/javascript">impress().init()</script>
		<script type="text/javascript" src="lib/ace/ace.js" charset="utf-8"></script>
		<script type="text/javascript" src="snake.js"></script>
		<script type="text/javascript">
				var scriptHoister =function(scriptText){
					setTimeout(function(){
			            if (scriptText) {
			                var head = document.getElementsByTagName("head")[0] || document.documentElement,
			                    script = document.createElement("script");
			                script.type = "text/javascript";
			                script.text = scriptText;
			                head.appendChild(script);
			                head.removeChild(script);
			            }
		            },10);
				};

				var makeEditor = function(id, removeCode){
					var editor = ace.edit(id);
					if(removeCode){
						editor.getSession().setValue('');
					}

					editor.setShowPrintMargin(false);
					editor.setTheme("ace/theme/monokai");
				    editor.getSession().setMode("ace/mode/javascript");
				    editor.getSession().setTabSize(4);
				    editor.getSession().setUseSoftTabs(true);
				    editor.getSession().setUseWorker(true);

				    editor.commands.addCommand({
					    name: 'Save',
					    bindKey: {win: 'Ctrl-S',  mac: 'Command-S'},
					    exec: function(editor) {
					        //...
					    },
					    readOnly: true // false if this command should not apply in readOnly mode
					});
					editor.setFontSize(20);
					return editor;
				};

				var interval = undefined;
				var running = false;
				var clearAnimation = function(){
					if(interval){clearInterval(interval)};
					running = false;
				};

				var hideDemoCode = false;
				var drawingEditor = makeEditor('drawing-editor', hideDemoCode);
				var movementEditor = makeEditor('movement-editor', hideDemoCode);
				var timingEditor = makeEditor('timing-editor');
				var gameloopEditor = makeEditor('gameloop-editor');
				var keycodeVectorEditor = makeEditor('keycode-vector-editor');
				var keycodeKonamiEditor = makeEditor('keycode-konami-editor');
				//var actorEditor = makeEditor('actor-editor');
				//var sceneGraphEditor = makeEditor('scene-graph-editor');

				
				// Setup coding demos
				$('#btn-drawing').on('click', function(){
					clearAnimation();
					var code = drawingEditor.getSession().getValue();
					scriptHoister(code);
				});

				$('#btn-time-based-movement').on('click', function(){
					clearAnimation();
					var code = movementEditor.getSession().getValue();
					scriptHoister(code);
				});

				$('#btn-timing').on('click', function(){
					clearAnimation();
					var code = timingEditor.getSession().getValue();
					scriptHoister(code);
				});



		</script>
	</body>
</html>